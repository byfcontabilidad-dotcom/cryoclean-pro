<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryoClean Pro Admin - Gestión Total</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        /* Estilos Base y Variables */
        :root {
            --primary: #10b981; --secondary: #3b82f6; --dark: #1e293b;
            --danger: #ef4444; --light: #f8fafc;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f1f5f9; color: var(--dark); padding-bottom: 50px; }
        
        /* Layout */
        .header { background: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* UI Components */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-edit { background: var(--secondary); color: white; margin-right: 5px; }
        
        /* Forms & Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        
        /* Gallery specific */
        .gallery-item img, .gallery-item iframe { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; }
        .admin-controls { margin-top: 15px; display: flex; justify-content: flex-end; }
        .badge { position: absolute; top: 10px; right: 10px; background: var(--primary); color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; }
    </style>
</head>
<body>

<div class="header">
    <div class="nav-container">
        <h2>❄️ CryoClean Admin</h2>
        <div>
            <button class="btn btn-primary" onclick="openModal('serviceModal')">+ Servicio</button>
            <button class="btn btn-primary" onclick="openModal('galleryModal')">+ Galería</button>
        </div>
    </div>
</div>

<div class="container">
    <h2 style="margin-bottom: 20px;">Catálogo de Servicios</h2>
    <div id="servicesGrid" class="grid"></div>

    <hr style="margin: 50px 0; border: 0; border-top: 1px solid #ccc;">

    <h2 style="margin-bottom: 20px;">Galería de Proyectos</h2>
    <div id="galleryGrid" class="grid"></div>
</div>

<div id="serviceModal" class="modal">
    <div class="modal-content">
        <h3 id="serviceTitle">Nuevo Servicio</h3>
        <input type="hidden" id="serviceId">
        <input type="text" id="serviceName" placeholder="Nombre del servicio">
        <textarea id="serviceDesc" placeholder="Descripción"></textarea>
        <input type="number" id="servicePrice" placeholder="Precio ($)">
        <input type="text" id="serviceIcon" placeholder="Emoji o Icono (p.ej. ❄️)">
        <button class="btn btn-primary" onclick="saveService()" style="width: 100%;">Guardar</button>
        <button class="btn" onclick="closeModal('serviceModal')" style="width: 100%; margin-top:10px;">Cancelar</button>
    </div>
</div>

<div id="galleryModal" class="modal">
    <div class="modal-content">
        <h3>Añadir a Galería</h3>
        <select id="galleryType" onchange="toggleGalleryInputs()">
            <option value="image">Imagen</option>
            <option value="video">Video (YouTube)</option>
        </select>
        <input type="text" id="galleryTitle" placeholder="Título del proyecto">
        <input type="url" id="galleryUrl" placeholder="URL de la imagen o video">
        <button class="btn btn-primary" onclick="saveGalleryItem()" style="width: 100%;">Publicar</button>
        <button class="btn" onclick="closeModal('galleryModal')" style="width: 100%; margin-top:10px;">Cancelar</button>
    </div>
</div>

<script>
    // CONFIGURACIÓN FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyBsPssHAMzBzYrHvdMFqtR31n2E55ovr8A",
        authDomain: "cryocleanpro.firebaseapp.com",
        projectId: "cryocleanpro",
        storageBucket: "cryocleanpro.firebasestorage.app",
        messagingSenderId: "835260147208",
        appId: "1:835260147208:web:6cfd00fc634ded777353bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // FUNCIONES DE SERVICIOS
    function loadServices() {
        db.collection('servicios').onSnapshot(snapshot => {
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';
            snapshot.forEach(doc => {
                const s = doc.data();
                grid.innerHTML += `
                    <div class="card">
                        <span class="badge">$${s.price}</span>
                        <div style="font-size: 30px;">${s.icon || '⚙️'}</div>
                        <h3>${s.name}</h3>
                        <p style="color: #666; font-size: 14px;">${s.description}</p>
                        <div class="admin-controls">
                            <button class="btn btn-edit" onclick="editService('${doc.id}', ${JSON.stringify(s).replace(/"/g, '&quot;')})">Editar</button>
                            <button class="btn btn-danger" onclick="deleteItem('servicios', '${doc.id}')">Borrar</button>
                        </div>
                    </div>`;
            });
        });
    }

    function saveService() {
        const id = document.getElementById('serviceId').value;
        const data = {
            name: document.getElementById('serviceName').value,
            description: document.getElementById('serviceDesc').value,
            price: document.getElementById('servicePrice').value,
            icon: document.getElementById('serviceIcon').value
        };

        if(id) {
            db.collection('servicios').doc(id).update(data);
        } else {
            db.collection('servicios').add(data);
        }
        closeModal('serviceModal');
        clearServiceForm();
    }

    function editService(id, data) {
        document.getElementById('serviceId').value = id;
        document.getElementById('serviceName').value = data.name;
        document.getElementById('serviceDesc').value = data.description;
        document.getElementById('servicePrice').value = data.price;
        document.getElementById('serviceIcon').value = data.icon;
        document.getElementById('serviceTitle').innerText = "Editar Servicio";
        openModal('serviceModal');
    }

    // FUNCIONES DE GALERÍA
    function loadGallery() {
        db.collection('galeria').onSnapshot(snapshot => {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';
            snapshot.forEach(doc => {
                const item = doc.data();
                let mediaHtml = item.type === 'video' 
                    ? `<iframe src="${transformYoutubeUrl(item.url)}" frameborder="0"></iframe>`
                    : `<img src="${item.url}" alt="Proyecto">`;
                
                grid.innerHTML += `
                    <div class="card gallery-item">
                        ${mediaHtml}
                        <p style="margin-top:10px;"><strong>${item.title}</strong></p>
                        <div class="admin-controls">
                            <button class="btn btn-danger" onclick="deleteItem('galeria', '${doc.id}')">Eliminar</button>
                        </div>
                    </div>`;
            });
        });
    }

    function saveGalleryItem() {
        const data = {
            type: document.getElementById('galleryType').value,
            title: document.getElementById('galleryTitle').value,
            url: document.getElementById('galleryUrl').value,
            createdAt: new Date()
        };
        db.collection('galeria').add(data).then(() => closeModal('galleryModal'));
    }

    // UTILIDADES
    function deleteItem(collection, id) {
        if(confirm('¿Seguro que deseas eliminar este elemento?')) {
            db.collection(collection).doc(id).delete();
        }
    }

    function transformYoutubeUrl(url) {
        if (!url) return '';
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? `https://www.youtube.com/embed/${match[2]}` : url;
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function clearServiceForm() {
        document.getElementById('serviceId').value = '';
        document.getElementById('serviceName').value = '';
        document.getElementById('serviceTitle').innerText = "Nuevo Servicio";
    }

    // Inicializar
    window.onload = () => {
        loadServices();
        loadGallery();
    };
</script>

</body>
</html>
